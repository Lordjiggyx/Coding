import{i as t,d as e,l as n,a as r,e as i,f as o,g as a,m as u,b as s,_ as c,h as l,k as p}from"./index-7c3a2ef8.js";import f,{PureComponent as d}from"react";import m from"prop-types";import v,{css as h}from"styled-components";import{a as b}from"./_curry2-12509879.js";import"./_has-bd75b317.js";import{C as g}from"./colors-fe7a2ec1.js";import{i as x}from"./featureDetects-426db7d2.js";import{m as y,S as R}from"./index-2a1ab813.js";import{n as _}from"./path-f5ccb8a3.js";import"./_isString-9eecd9ee.js";import"classnames";import{a as k}from"./attachClassName-14171279.js";import{_ as E}from"./pick-3fb86206.js";import{k as L}from"./_isArray-a8fe11f0.js";import{_ as S,c as w,j,k as T,t as q}from"./misc-78673da2.js";import{_ as A,a as I}from"./_xfBase-c1afe6f2.js";import"stream";import C from"uniqid";import D from"react-click-outside";import{_ as M}from"./isEmpty-80c9cae4.js";import{_ as O}from"./find-beb57f40.js";import{a as F,_ as B,c as W,b as z}from"./_map-7921efc2.js";import{_ as G}from"./_concat-41edd650.js";import{d as H}from"./charts-7fb9ca4e.js";var N=b((function(t,e){return G(e,[t])})),P=[g.VIBRANT_GREEN,g.VIBRANT_MAGENTA,g.VIBRANT_CYAN,g.VIBRANT_YELLOW,g.RICH_PURPLE,g.RICH_BLUE,g.RICH_GREEN];function V(){var t=e(["\n  display: inline-block;\n  margin-right: 10px;\n  width: 12px;\n  height: 12px;\n  background-color: ",";\n  border-radius: 3px;\n  border-top-right-radius: 6px;\n"]);return V=function(){return t},t}function U(){var t=e(["\n  font-size: 12px;\n  padding-right: 20px;\n  padding-bottom: 10px;\n  color: ",";\n  cursor: pointer;\n  opacity: ",";\n"]);return U=function(){return t},t}function Y(){var t=e(["\n    justify-content: flex-start;\n  "]);return Y=function(){return t},t}function X(){var t=e(["\n  margin-top: 23px;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  ","\n"]);return X=function(){return t},t}var Z=v.div(X(),y.max.phone(Y())),J=v.div.attrs((function(){return{"data-test-value":"chart-label"}}))(U(),(function(t){return t.theme.colors.richBlack.base}),(function(t){return t.isSelected?1:.3})),K=v.div(V(),(function(t){return t.color})),Q=function(t){var e=t.name,n=t.color,r=t.onClick,i=t.isSelected;return f.createElement(J,{onClick:r,isSelected:i},f.createElement(K,{color:n}),e)};Q.propTypes={name:m.string.isRequired,color:m.string.isRequired,isSelected:m.bool,onClick:m.func},Q.defaultProps={onClick:function(){},isSelected:!0};var $,tt,et,nt=function(e){var n=e.labels,r=e.onLabelClick,i=e.selectedLabelsIds;return f.createElement(Z,null,n.map((function(e){return f.createElement(Q,t({key:e.id},e,{onClick:r(e),isSelected:(n=e.id,M(i)||S(n,i))}));var n})))};function rt(){var t=e(["\n  > div {\n    margin-right: 6px;\n  }\n"]);return rt=function(){return t},t}function it(){var t=e(["\n  font-size: 14px;\n  font-weight: ",";\n"]);return it=function(){return t},t}function ot(){var t=e(["\n            left: 0;\n            right: 0;\n          "]);return ot=function(){return t},t}function at(){var t=e(["\n            right: ","px;\n          "]);return at=function(){return t},t}function ut(){var t=e(["\n            left: ","px;\n          "]);return ut=function(){return t},t}function st(){var t=e(["\n      transform: translateX(-","px);\n    "]);return st=function(){return t},t}function ct(){var t=e(["\n  position: absolute;\n  z-index: 1;\n  top: 0;\n  width: ","px;\n  height: ","px;\n  ","\n  padding: 15px;\n  text-align: left;\n  background-color: ",";\n  border-radius: ",";\n  box-shadow: ",";\n  &:after {\n    content: '';\n    position: absolute;\n    ","\n    width: 0;\n    height: ","px;\n    bottom: -","px;\n    box-sizing: border-box;\n    margin: auto;\n    border-top: ","px solid\n      ",";\n    border-right: ","px solid transparent;\n    border-left: ","px solid transparent;\n  }\n"]);return ct=function(){return t},t}function lt(){var t=e(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  margin: auto;\n  pointer-events: none;\n"]);return lt=function(){return t},t}nt.propTypes={labels:m.arrayOf(m.shape(E(["name","color"],Q.propTypes))).isRequired,onLabelClick:m.func.isRequired,selectedLabelsIds:m.arrayOf(m.string).isRequired};var pt=v.div(lt()),ft=v.div(ct(),175,68,(function(t){return!t.isLeftAligned&&!t.isRightAligned&&h(st(),87.5)}),(function(t){return t.theme.colors.white.base}),(function(t){return t.theme.borderRadius}),(function(t){return t.theme.boxShadow}),(function(t){return t.isLeftAligned?h(ut(),10):t.isRightAligned?h(at(),10):h(ot())}),10,10,10,(function(t){return t.theme.colors.white.base}),10,10),dt=v.div(it(),(function(t){return t.theme.fontWeight.black})),mt=v(Q)(rt()),vt=function(t){var e=t.x,n=t.isLeftAligned,r=t.isRightAligned;return n?e-20:r?e-175+20:e},ht=D((et=tt=function(t){function e(){var t,r;i(this,e);for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return r=o(this,(t=a(e)).call.apply(t,[this].concat(c))),n(u(r),"handleClickOutside",r.props.resetTooltip),r}return r(e,d),s(e,[{key:"render",value:function(){var t=this.props,e=t.width,n=t.tooltipData,r=t.isLeftAligned,i=t.isRightAligned;return f.createElement(pt,{style:{width:e}},f.createElement(ft,{isLeftAligned:r,isRightAligned:i,style:{top:"".concat(n.y-68-15,"px"),left:vt({x:n.x,isLeftAligned:r,isRightAligned:i})}},f.createElement(mt,n.label),f.createElement(dt,null,n.value)))}}]),e}(),n(tt,"propTypes",{width:m.string.isRequired,tooltipData:m.object.isRequired,isLeftAligned:m.bool.isRequired,isRightAligned:m.bool.isRequired,resetTooltip:m.func.isRequired}),$=et))||$;function bt(){var t=e(["\n    padding: 7px 15px;\n  "]);return bt=function(){return t},t}function gt(){var t=e(["\n  display: inline-block;\n  margin-top: 16px;\n  padding: 7px 30px;\n  font-size: 12px;\n  font-weight: ",";\n  border-radius: ",";\n  background-color: ",";\n  ","\n"]);return gt=function(){return t},t}function xt(){var t=e(["\n  margin-top: 5px;\n  opacity: 0.3;\n  font-size: 12px;\n"]);return xt=function(){return t},t}function yt(){var t=e(["\n  cursor: pointer;\n"]);return yt=function(){return t},t}function Rt(){var t=e(["\n  transform: scale(1, -1);\n"]);return Rt=function(){return t},t}function _t(){var t=e(["\n    margin-left: 20px;\n    margin-right: 20px;\n  "]);return _t=function(){return t},t}function kt(){var t=e(["\n  margin-left: 50px;\n  margin-right: 50px;\n  ","\n"]);return kt=function(){return t},t}function Et(){var t=e(["\n  position: relative;\n  display: inline-block;\n  text-align: center;\n"]);return Et=function(){return t},t}var Lt=v.div(Et()),St=v.div(kt(),y.max.phone(_t())),wt=v.svg(Rt()),jt=v.path(yt()),Tt=v.div(xt()),qt=v.div.attrs((function(){return{"data-test-value":"bar-chart-sum-label"}}))(gt(),(function(t){return t.theme.fontWeight.black}),(function(t){return t.theme.borderRadius}),(function(t){return t.theme.colors.sensitiveGrey.base}),y.max.phone(bt())),At=function(e){var n=e.point,r=e.selectedLabelsIds,i=e.topOffset,o=e.valueFormatter,a=e.isInFirstGroup,u=e.isInLastGroup,s=e.setTooltipData,c=e.resetTooltip,l=e.tooltipData,p=e.barWidth,d=e.onBarClick,m=function(t,e){return d(t.label)},v=n.values.length*(p+8)-8,h=n.sum||n.values.reduce((function(t,e){return t+e.value}),0),b=l&&S(l.id,n.values.map(F("id")));return f.createElement(Lt,null,f.createElement(St,null,f.createElement(wt,{width:v,height:244,viewBox:"0 0 ".concat(v," ").concat(244)},n.values.map((function(e,n){var a=n*(p+8),u=a+p,l=1-100*i/244/100,d=function(t){return 244*t/100}(e.valueAsPercentage*l),v=!M(r)&&!S(e.label.id,r),h={x:a+p/2,y:244-d,value:o(e.value),id:e.id,label:e.label},b=x()?{onClick:s(h)}:{onClick:m(e),onMouseEnter:s(h),onMouseLeave:c};return f.createElement(jt,t({key:e.id,d:"\n                      M ".concat(a," 0\n                      H ").concat(u,"\n                      V ").concat(d-p,"\n                      C\n                        ").concat(u," ").concat(d,"\n                        ").concat(u," ").concat(d,"\n                        ").concat(a," ").concat(d,"\n                      V ").concat(a,"\n                      Z\n                    "),fill:e.label.color,style:{opacity:v?.2:1}},b))}))),b&&f.createElement(ht,{isLeftAligned:a,isRightAligned:u,width:"".concat(v,"px"),tooltipData:l,resetTooltip:c})),f.createElement(Tt,null,n.x),f.createElement(qt,null,o(h)))};function It(){var t=e(["\n  pointer-events: none;\n  position: absolute;\n  left: 0;\n  width: 100%;\n  height: 1px;\n  background-color: ",";\n  opacity: ",";\n"]);return It=function(){return t},t}At.propTypes={point:m.object.isRequired,onBarClick:m.func.isRequired,selectedLabelsIds:m.array.isRequired,topOffset:m.number.isRequired,valueFormatter:m.func.isRequired,isInFirstGroup:m.bool.isRequired,isInLastGroup:m.bool.isRequired,setTooltipData:m.func.isRequired,resetTooltip:m.func.isRequired,tooltipData:m.object,barWidth:m.number.isRequired},At.defaultProps={tooltipData:null};var Ct=v.div(It(),(function(t){return t.theme.colors.primary.base}),(function(t){return t.isVisible?1:0}));function Dt(){var t=e(["\n  position: relative;\n  display: inline-flex;\n  overflow-x: scroll;\n  -ms-overflow-style: -ms-autohiding-scrollbar;\n  max-width: 100%;\n  padding-left: 5px;\n  padding-right: 5px;\n  padding-top: 100px;\n  margin-top: -100px;\n"]);return Dt=function(){return t},t}var Mt=v.div(Dt()),Ot=function(e){var n=e.data,r=l(e,["data"]);return f.createElement(Mt,null,n.map((function(e,i){return f.createElement(At,t({key:e.id,point:e},r,{isInFirstGroup:0===i,isInLastGroup:i===n.length-1}))})))};Ot.propTypes={data:m.array.isRequired};var Ft=function(t,e){var l,p;return x()?t:(p=l=function(e){function l(){var t,e;i(this,l);for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];return e=o(this,(t=a(l)).call.apply(t,[this].concat(s))),n(u(e),"state",{position:0,isInHoverRange:!1,min:0,max:0}),n(u(e),"recomputeState",(function(){var t=e.containerRef.getBoundingClientRect(),n=t.top,r=t.height,i=e.props.max;e.setState({min:n,max:i||n+r})})),n(u(e),"handleMouseMove",(function(t){var n=e.state,r=n.min,i=n.max,o=t.clientY-r;e.setState({position:Math.min(o,i),isInHoverRange:o>=0})})),n(u(e),"handleMouseEnter",(function(){e.setState({isInHoverRange:!0}),document.addEventListener("mousemove",e.handleMouseMove)})),n(u(e),"handleMouseLeave",(function(){e.setState({isInHoverRange:!1}),document.removeEventListener("mousemove",e.handleMouseMove)})),e}return r(l,d),s(l,[{key:"componentDidMount",value:function(){document.addEventListener("scroll",this.recomputeState),setTimeout(this.recomputeState,1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("scroll",this.recomputeState)}},{key:"render",value:function(){var e=this,n=this.props,r=n.hideLine,i=n.lineStyle,o=this.state,a=o.position,u=o.isInHoverRange;return f.createElement("div",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,ref:function(t){e.containerRef=t}},f.createElement(t,this.props),f.createElement(Ct,{isVisible:!r&&u,style:c({},i,{top:"".concat(a,"px")})}))}}]),l}(),n(l,"propTypes",{hideLine:m.bool,max:m.number,lineStyle:m.object}),n(l,"defaultProps",c({hideLine:!1,max:null,lineStyle:{}},e)),p)}(Ot,{max:244,lineStyle:{marginLeft:"".concat(50,"px"),width:"calc(100% - ".concat(50,"px)")}}),Bt=_(0),Wt=function(){function t(){this._nativeSet="function"==typeof Set?new Set:null,this._items={}}return t.prototype.add=function(t){return!zt(t,!0,this)},t.prototype.has=function(t){return zt(t,!1,this)},t}();function zt(t,e,n){var r,i=typeof t;switch(i){case"string":case"number":return 0===t&&1/t==-1/0?!!n._items["-0"]||(e&&(n._items["-0"]=!0),!1):null!==n._nativeSet?e?(r=n._nativeSet.size,n._nativeSet.add(t),n._nativeSet.size===r):n._nativeSet.has(t):i in n._items?t in n._items[i]||(e&&(n._items[i][t]=!0),!1):(e&&(n._items[i]={},n._items[i][t]=!0),!1);case"boolean":if(i in n._items){var o=t?1:0;return!!n._items[i][o]||(e&&(n._items[i][o]=!0),!1)}return e&&(n._items[i]=t?[!1,!0]:[!0,!1]),!1;case"function":return null!==n._nativeSet?e?(r=n._nativeSet.size,n._nativeSet.add(t),n._nativeSet.size===r):n._nativeSet.has(t):i in n._items?!!w(t,n._items[i])||(e&&n._items[i].push(t),!1):(e&&(n._items[i]=[t]),!1);case"undefined":return!!n._items[i]||(e&&(n._items[i]=!0),!1);case"object":if(null===t)return!!n._items.null||(e&&(n._items.null=!0),!1);default:return(i=Object.prototype.toString.call(t))in n._items?!!w(t,n._items[i])||(e&&n._items[i].push(t),!1):(e&&(n._items[i]=[t]),!1)}}var Gt=b((function(t,e){for(var n,r,i=new Wt,o=[],a=0;a<e.length;)n=t(r=e[a]),i.add(n)&&o.push(r),a+=1;return o})),Ht=function(){function t(t,e){this.xf=e,this.f=t}return t.prototype["@@transducer/init"]=A.init,t.prototype["@@transducer/result"]=A.result,t.prototype["@@transducer/step"]=function(t,e){return this.xf["@@transducer/step"](t,this.f(e))},t}(),Nt=b(I(["fantasy-land/map","map"],b((function(t,e){return new Ht(t,e)})),(function(t,e){switch(Object.prototype.toString.call(e)){case"[object Function]":return W(e.length,(function(){return t.call(this,e.apply(this,arguments))}));case"[object Object]":return j((function(n,r){return n[r]=t(e[r]),n}),{},L(e));default:return B(t,e)}}))),Pt=b((function(t,e){return Nt(F(t),e)})),Vt=function(t){var e=Pt("values",t).map(Pt("value"));return Bt(e.reduce((function(t,e){return[].concat(p(t),p(e))}),[]).sort((function(t,e){return e-t})))},Ut=function(t){return 1e3*Math.round(t/1e3)},Yt=function(t){var e=Vt(t),n=function(t){return t.reduce((function(t,e){var n=e.values,r=Pt("label",n);return Gt(F("name"),[].concat(p(t),p(r)))}),[]).map((function(t,e){return c({id:"l-".concat(C()),color:T(e,P)},t)}))}(t);return{data:t.map((function(t,r){return c({},t,{id:"p-".concat(C()),values:t.values.map((function(t){return c({id:"v-".concat(C()),valueAsPercentage:100*t.value/e},t,{label:(r=t.label.name,i=n,O((function(t){return t.name===r}),i))});var r,i}))})})),labels:n}};function Xt(){var t=e(["\n  opacity: 0.3;\n  font-size: 12px;\n"]);return Xt=function(){return t},t}function Zt(){var t=e(["\n  width: 100%;\n  height: 1px;\n  border-top: 1px ","\n    ",";\n"]);return Zt=function(){return t},t}function Jt(){var t=e(["\n  height: 100%;\n  width: calc(100% - ","px);\n  padding-left: ","px;\n"]);return Jt=function(){return t},t}function Kt(){var t=e(["\n  position: absolute;\n  left: 0;\n  top: -","px;\n  height: calc(100% + ","px);\n"]);return Kt=function(){return t},t}function Qt(){var t=e(["\n  display: flex;\n  flex-direction: column-reverse;\n  justify-content: space-between;\n  align-items: flex-end;\n"]);return Qt=function(){return t},t}function $t(){var t=e(["\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: calc(100% + ","px);\n  height: ","px;\n"]);return $t=function(){return t},t}var te=v.div($t(),35,244),ee=v.div(Qt()),ne=v(ee)(Kt(),8,16),re=v(ee)(Jt(),35,50),ie=v.div(Zt(),(function(t){return t.isSolid?"solid":"dashed"}),(function(t){return t.theme.colors.sensitiveGrey.dark})),oe=v.div(Xt()),ae=function(t){var e=t.data,n=t.tickFormatter,r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6;if(0===t.length)return[];var r=100*Vt(t)/(100-e),i=Ut(r/n);return q(n+1).map((function(t){return t*i}))}(e,100*t.topOffset/244);return f.createElement(te,null,f.createElement(ne,null,r.map((function(t,e){return f.createElement(oe,{key:e},n(t))}))),f.createElement(re,null,r.map((function(t,e){return f.createElement(ie,{key:e,isSolid:0===e})}))))};function ue(){var t=e(["\n  margin-left: 20px;\n"]);return ue=function(){return t},t}function se(){var t=e(["\n  position: relative;\n  display: inline-block;\n  max-width: 100%;\n  margin-top: ","px;\n  padding-left: ","px;\n"]);return se=function(){return t},t}ae.propTypes={data:m.array.isRequired,tickFormatter:m.func.isRequired,topOffset:m.number.isRequired};var ce=v.div(se(),16,35),le=v.div(ue()),pe=function(){return function(){if("undefined"!=typeof document)return window.innerWidth<=R.phone}()?15:7},fe=function(t){function e(){var t,r;i(this,e);for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return r=o(this,(t=a(e)).call.apply(t,[this].concat(c))),n(u(r),"state",{data:[],labels:[],selectedLabelsIds:[],tooltipData:null,barWidth:pe()}),n(u(r),"resetTooltip",(function(){return r.setState({tooltipData:null})})),n(u(r),"setTooltipData",(function(t){return function(){var e=r.state.tooltipData&&r.state.tooltipData.id;r.setState({tooltipData:e===t.id?null:t})}})),n(u(r),"setBarWidth",(function(){r.setState({barWidth:pe()})})),n(u(r),"handleLabelClick",(function(t){var e=t.id;return function(){var t=r.state.selectedLabelsIds,n=S(e,t);r.setState({selectedLabelsIds:n?z([e],t):N(e,t)})}})),r}return r(e,d),s(e,[{key:"componentDidMount",value:function(){var t=this.props.data;this.setState(Yt(t)),window.addEventListener("resize",this.setBarWidth)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.setBarWidth)}},{key:"render",value:function(){var t=this.props,e=t.yTickFormatter,n=t.valueFormatter,r=t.topOffset,i=(t.data,l(t,["yTickFormatter","valueFormatter","topOffset","data"])),o=this.state,a=o.data,u=o.labels,s=o.selectedLabelsIds,c=o.tooltipData,p=o.barWidth;return f.createElement(ce,i,f.createElement(ae,{data:a,tickFormatter:e,topOffset:r}),f.createElement(Ft,{data:a,onBarClick:this.handleLabelClick,selectedLabelsIds:s,topOffset:r,valueFormatter:n,setTooltipData:this.setTooltipData,resetTooltip:this.resetTooltip,tooltipData:c,barWidth:p}),f.createElement(le,null,f.createElement(nt,{labels:u,onLabelClick:this.handleLabelClick,selectedLabelsIds:s})))}}]),e}();n(fe,"propTypes",{data:m.arrayOf(m.shape({values:m.arrayOf(m.shape({value:m.number.isRequired,label:m.shape({name:m.string.isRequired,color:m.string}).isRequired})).isRequired,x:m.string.isRequired,sum:m.number})).isRequired,yTickFormatter:m.func,valueFormatter:m.func,topOffset:m.number}),n(fe,"defaultProps",{yTickFormatter:H,valueFormatter:H,topOffset:20});var de=k(fe).Component;export default de;export{fe as BarChart};
